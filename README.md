# üèõÔ∏è Gest√£o Pol√≠tica - Sistema de Campanha Eleitoral

[![TypeScript](https://img.shields.io/badge/TypeScript-007ACC?style=for-the-badge&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![React](https://img.shields.io/badge/React-20232A?style=for-the-badge&logo=react&logoColor=61DAFB)](https://reactjs.org/)
[![Vite](https://img.shields.io/badge/Vite-646CFF?style=for-the-badge&logo=vite&logoColor=white)](https://vitejs.dev/)
[![Supabase](https://img.shields.io/badge/Supabase-3ECF8E?style=for-the-badge&logo=supabase&logoColor=white)](https://supabase.com/)
[![Tailwind CSS](https://img.shields.io/badge/Tailwind_CSS-38B2AC?style=for-the-badge&logo=tailwind-css&logoColor=white)](https://tailwindcss.com/)

> Sistema completo para gest√£o de campanhas pol√≠ticas do **Vereador Wilian Tonezi - PL**

## üìã √çndice

- [üéØ Vis√£o Geral](#-vis√£o-geral)
- [‚ú® Funcionalidades](#-funcionalidades)
- [üõ†Ô∏è Tecnologias](#Ô∏è-tecnologias)
- [üöÄ Instala√ß√£o](#-instala√ß√£o)
- [‚öôÔ∏è Configura√ß√£o](#Ô∏è-configura√ß√£o)
- [üì± PWA](#-pwa)
- [üß™ Testes](#-testes)
- [üìö Documenta√ß√£o](#-documenta√ß√£o)
- [ü§ù Contribui√ß√£o](#-contribui√ß√£o)
- [üìÑ Licen√ßa](#-licen√ßa)

## üéØ Vis√£o Geral

O **Sistema de Gest√£o Pol√≠tica** √© uma aplica√ß√£o web moderna e responsiva desenvolvida para gerenciar campanhas eleitorais de forma eficiente e organizada. O sistema oferece funcionalidades completas para:

- üë• **Gest√£o de Contatos**: Cadastro e organiza√ß√£o de eleitores
- üó∫Ô∏è **Mapeamento Geogr√°fico**: Visualiza√ß√£o de contatos em mapa
- üìä **An√°lise de Dados**: Estat√≠sticas e proje√ß√µes eleitorais
- üè∑Ô∏è **Sistema de Tags**: Categoriza√ß√£o e segmenta√ß√£o
- üì± **PWA**: Funciona offline e pode ser instalado como app

## ‚ú® Funcionalidades

### üè† Dashboard
- **Vis√£o Geral**: Estat√≠sticas em tempo real da campanha
- **Metas**: Acompanhamento de objetivos eleitorais
- **Aniversariantes**: Lista de pessoas com anivers√°rio
- **Contagem Regressiva**: Tempo restante para as elei√ß√µes

### üë• Gest√£o de Pessoas
- **Cadastro Completo**: Dados pessoais, contato e endere√ßo
- **Valida√ß√£o Inteligente**: Verifica√ß√£o de duplicidade de WhatsApp
- **Busca Avan√ßada**: Filtros por localiza√ß√£o, tags e status
- **Importa√ß√£o/Exporta√ß√£o**: Dados em CSV

### üó∫Ô∏è Mapa Interativo
- **Visualiza√ß√£o Geogr√°fica**: Contatos plotados no mapa
- **Clusters Inteligentes**: Agrupamento por proximidade
- **Filtros Din√¢micos**: Por bairro, cidade e tags
- **Geolocaliza√ß√£o**: Busca por CEP e coordenadas

### üè∑Ô∏è Sistema de Tags
- **Categoriza√ß√£o**: Organiza√ß√£o por segmentos
- **Cores Personalizadas**: Identifica√ß√£o visual
- **Filtros**: Busca por tags espec√≠ficas
- **Estat√≠sticas**: Contagem por categoria

### üëë Gest√£o de L√≠deres
- **Hierarquia**: Estrutura organizacional
- **Metas Individuais**: Objetivos por l√≠der
- **Relat√≥rios**: Performance e resultados
- **Convites**: Sistema de convite para novos l√≠deres

### üìä Proje√ß√µes Eleitorais
- **An√°lise de Dados**: Tend√™ncias e padr√µes
- **Relat√≥rios**: Estat√≠sticas detalhadas
- **Exporta√ß√£o**: Dados para an√°lise externa

## üõ†Ô∏è Tecnologias

### Frontend
- **React 18** - Biblioteca de interface
- **TypeScript** - Tipagem est√°tica
- **Vite** - Build tool e dev server
- **Tailwind CSS** - Framework CSS
- **React Hook Form** - Gerenciamento de formul√°rios
- **Zod** - Valida√ß√£o de schemas
- **React Router** - Roteamento
- **Framer Motion** - Anima√ß√µes

### Backend & Database
- **Supabase** - Backend as a Service
- **PostgreSQL** - Banco de dados
- **Row Level Security (RLS)** - Seguran√ßa de dados
- **Real-time** - Atualiza√ß√µes em tempo real

### APIs & Integra√ß√µes
- **Google Maps API** - Mapas e geolocaliza√ß√£o
- **ViaCEP** - Busca de endere√ßos por CEP
- **WhatsApp API** - Integra√ß√£o de mensagens

### Ferramentas de Desenvolvimento
- **Vitest** - Framework de testes
- **Testing Library** - Testes de componentes
- **ESLint** - Linting de c√≥digo
- **Prettier** - Formata√ß√£o de c√≥digo

## üöÄ Instala√ß√£o

### Pr√©-requisitos
- Node.js 18+ 
- npm ou yarn
- Conta no Supabase
- Chave da API do Google Maps

### 1. Clone o reposit√≥rio
```bash
git clone https://github.com/seu-usuario/gestao-politica.git
cd gestao-politica
```

### 2. Instale as depend√™ncias
```bash
npm install
```

### 3. Configure as vari√°veis de ambiente
```bash
cp .env.example .env
```

Edite o arquivo `.env` com suas credenciais:
```env
VITE_SUPABASE_URL=sua_url_do_supabase
VITE_SUPABASE_ANON_KEY=sua_chave_anonima
VITE_GOOGLE_MAPS_API_KEY=sua_chave_do_google_maps
VITE_DEBUG=false
```

### 4. Execute o projeto
```bash
npm run dev
```

O projeto estar√° dispon√≠vel em `http://localhost:5173`

## ‚öôÔ∏è Configura√ß√£o

### Supabase Setup

1. **Crie um projeto no Supabase**
2. **Execute as migra√ß√µes**:
   ```bash
   npm run supabase:setup
   ```
3. **Configure RLS policies**
4. **Execute seed data** (opcional)

### Google Maps Setup

1. **Ative a Google Maps API**
2. **Configure dom√≠nios permitidos**
3. **Adicione a chave no .env**

### Edge Functions Setup

As Edge Functions agora suportam CORS din√¢mico baseado em vari√°veis de ambiente:

#### Vari√°veis de Ambiente (Edge Functions)

```bash
# CORS - URLs permitidas (separadas por v√≠rgula)
ALLOWED_ORIGINS=https://app.gabitechnology.cloud,http://localhost:5173,http://127.0.0.1:5173

# URL padr√£o para fallback
DEFAULT_ORIGIN=https://app.gabitechnology.cloud
```

#### Configura√ß√£o no Supabase

1. **Acesse o Dashboard do Supabase**
2. **V√° para Edge Functions ‚Üí Settings**
3. **Adicione as vari√°veis de ambiente**:
   - `ALLOWED_ORIGINS`: Lista de URLs permitidas
   - `DEFAULT_ORIGIN`: URL padr√£o para fallback

#### Exemplo de Configura√ß√£o

```bash
# Para desenvolvimento local
ALLOWED_ORIGINS=http://localhost:5173,http://127.0.0.1:5173
DEFAULT_ORIGIN=http://localhost:5173

# Para produ√ß√£o
ALLOWED_ORIGINS=https://app.gabitechnology.cloud,https://gestaopolitica.com.br
DEFAULT_ORIGIN=https://app.gabitechnology.cloud
```

### Monitoramento e Healthcheck

O sistema inclui endpoints de monitoramento para verificar a sa√∫de das Edge Functions:

#### Endpoints Dispon√≠veis

- **`/functions/v1/ping`** - Ping simples para verificar se a fun√ß√£o est√° respondendo
- **`/functions/v1/health`** - Healthcheck completo com status de servi√ßos
- **`/functions/v1/status`** - Status de todas as Edge Functions

#### Exemplo de Uso

```bash
# Ping simples
curl https://seu-projeto.supabase.co/functions/v1/ping

# Healthcheck completo
curl https://seu-projeto.supabase.co/functions/v1/health

# Status de todas as fun√ß√µes
curl https://seu-projeto.supabase.co/functions/v1/status
```

#### Resposta do Healthcheck

```json
{
  "status": "healthy",
  "timestamp": "2024-01-15T10:30:00.000Z",
  "version": "1.0.0",
  "environment": "production",
  "services": {
    "database": "up",
    "auth": "up",
    "storage": "up"
  },
  "uptime": 1234567,
  "memory": {
    "used": 45,
    "total": 128,
    "percentage": 35
  },
  "responseTime": 150
}
```

### Rate Limiting

O sistema inclui prote√ß√£o contra spam e ataques de for√ßa bruta atrav√©s de rate limiting:

#### Configura√ß√µes de Rate Limiting

- **Geral**: 100 requests por 15 minutos
- **Convites**: 10 requests por hora (por IP)
- **Admin**: 50 requests por 5 minutos (por token + IP)
- **Ban/Unban**: 5 requests por hora (por token + IP)

#### Headers de Rate Limiting

```http
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1642248000
Retry-After: 300
```

#### Resposta de Rate Limit Excedido

```json
{
  "error": "Rate limit exceeded",
  "message": "Too many requests. Please try again later.",
  "retryAfter": 300,
  "resetTime": "2024-01-15T11:00:00.000Z"
}
```

### Sistema de Auditoria

O sistema inclui um sistema de auditoria aprimorado para monitoramento e rastreamento de atividades:

#### Endpoint de Logs de Auditoria

- **`/functions/v1/audit-logs`** - Visualizar logs de auditoria (apenas admin)

#### Exemplo de Uso

```bash
# Obter logs recentes
curl -H "Authorization: Bearer <token>" \
  https://seu-projeto.supabase.co/functions/v1/audit-logs

# Filtrar por severidade
curl -H "Authorization: Bearer <token>" \
  "https://seu-projeto.supabase.co/functions/v1/audit-logs?severity=error"

# Filtrar por fun√ß√£o
curl -H "Authorization: Bearer <token>" \
  "https://seu-projeto.supabase.co/functions/v1/audit-logs?function=invite_leader"
```

#### Estrutura dos Logs

```json
{
  "success": true,
  "data": {
    "logs": [
      {
        "id": "req_1642248000_abc123",
        "timestamp": "2024-01-15T10:30:00.000Z",
        "function": "invite_leader",
        "action": "invite_leader",
        "userId": "user-uuid",
        "userEmail": "admin@example.com",
        "userRole": "ADMIN",
        "ip": "192.168.1.1",
        "userAgent": "Mozilla/5.0...",
        "requestId": "req_1642248000_abc123",
        "method": "POST",
        "endpoint": "/functions/v1/invite_leader",
        "statusCode": 200,
        "responseTime": 150,
        "metadata": {
          "status": "NEW_USER",
          "targetEmail": "leader@example.com",
          "targetName": "Jo√£o Silva"
        },
        "severity": "info"
      }
    ],
    "stats": {
      "totalLogs": 1250,
      "bySeverity": {
        "info": 1000,
        "warn": 200,
        "error": 45,
        "critical": 5
      },
      "byFunction": {
        "invite_leader": 500,
        "admin_ban_user": 100,
        "leader_actions": 300
      },
      "averageResponseTime": 120,
      "errorRate": 4
    }
  }
}
```

#### N√≠veis de Severidade

- **info**: Opera√ß√µes normais e bem-sucedidas
- **warn**: Situa√ß√µes que requerem aten√ß√£o
- **error**: Erros que n√£o impedem o funcionamento
- **critical**: Erros cr√≠ticos que afetam o sistema

### Estrutura do Banco

```sql
-- Principais tabelas
people          -- Cadastro de pessoas
leaders         -- L√≠deres da campanha
tags            -- Sistema de tags
election_settings -- Configura√ß√µes da elei√ß√£o
```

## üì± PWA

O sistema √© uma **Progressive Web App** completa:

### ‚úÖ Funcionalidades PWA
- **Instala√ß√£o**: Pode ser instalado como app nativo
- **Offline**: Funciona sem conex√£o com cache inteligente
- **Notifica√ß√µes**: Push notifications para engajamento
- **Sincroniza√ß√£o**: Dados sincronizados automaticamente
- **Performance**: Carregamento instant√¢neo

### üì≤ Como Instalar
1. Acesse o sistema no navegador
2. Clique no √≠cone de instala√ß√£o
3. Confirme a instala√ß√£o
4. O app aparecer√° na tela inicial

## üß™ Testes

### Executar Testes
```bash
# Todos os testes
npm run test

# Modo watch
npm run test:watch

# Com coverage
npm run test:coverage

# Testes unit√°rios
npm run test:unit

# Testes de integra√ß√£o
npm run test:integration
```

### Cobertura de Testes
- **Threshold**: 70% m√≠nimo
- **Tipos**: Unit√°rios, integra√ß√£o e E2E
- **Ferramentas**: Vitest + Testing Library

## üìö Documenta√ß√£o

### üìñ Guias Dispon√≠veis
- [Guia de Instala√ß√£o](docs/INSTALLATION.md)
- [Configura√ß√£o do Supabase](docs/SUPABASE_SETUP.md)
- [API Reference](docs/API.md)
- [Guia de Contribui√ß√£o](docs/CONTRIBUTING.md)
- [Troubleshooting](docs/TROUBLESHOOTING.md)

### üèóÔ∏è Arquitetura
```
src/
‚îú‚îÄ‚îÄ components/     # Componentes React
‚îú‚îÄ‚îÄ pages/         # P√°ginas da aplica√ß√£o
‚îú‚îÄ‚îÄ hooks/         # Custom hooks
‚îú‚îÄ‚îÄ services/      # Servi√ßos e APIs
‚îú‚îÄ‚îÄ types/         # Defini√ß√µes TypeScript
‚îú‚îÄ‚îÄ lib/           # Utilit√°rios
‚îú‚îÄ‚îÄ test/          # Testes
‚îî‚îÄ‚îÄ styles/        # Estilos CSS
```

### üîß Scripts Dispon√≠veis
```bash
npm run dev          # Desenvolvimento
npm run build        # Build de produ√ß√£o
npm run preview      # Preview do build
npm run typecheck    # Verifica√ß√£o TypeScript
npm run lint         # Linting
npm run test         # Testes
npm run test:coverage # Testes com coverage
```

## ü§ù Contribui√ß√£o

### Como Contribuir
1. **Fork** o projeto
2. **Crie** uma branch para sua feature
3. **Commit** suas mudan√ßas
4. **Push** para a branch
5. **Abra** um Pull Request

### Padr√µes de C√≥digo
- **TypeScript** para tipagem
- **ESLint** para qualidade
- **Prettier** para formata√ß√£o
- **Conventional Commits** para mensagens

### Estrutura de Commits
```
feat: adiciona nova funcionalidade
fix: corrige bug
docs: atualiza documenta√ß√£o
style: formata√ß√£o de c√≥digo
refactor: refatora√ß√£o
test: adiciona testes
chore: tarefas de manuten√ß√£o
```

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa **MIT**. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

## üë®‚Äçüíª Desenvolvido por

**Vereador Wilian Tonezi - PL**
- üìß Email: tonezivereador@gmail.com
- üåê Website: [tonezi.com.br](https://tonezi.com.br)
- üì± WhatsApp: [Contato](https://wa.me/554797238106)

---

<div align="center">

**‚≠ê Se este projeto foi √∫til, considere dar uma estrela! ‚≠ê**

[![GitHub stars](https://img.shields.io/github/stars/seu-usuario/gestao-politica?style=social)](https://github.com/seu-usuario/gestao-politica)

</div>